# Start timer
zmodload zsh/datetime
zsh_start_time=$EPOCHREALTIME

autoload -Uz compinit && compinit

export XDG_CONFIG_HOME=$HOME/.config
export XDG_DATA_HOME=$HOME/.local/share

{{ if eq .osid "darwin" -}}
# Add user's bin to PATH
export PATH=$HOME/bin:$PATH

# Antidote
source $(brew --prefix)/opt/antidote/share/antidote/antidote.zsh
antidote load

# ENV variables
export EDITOR='nvim'
export AWS_PROFILE='default'
export OPENCODE_DISABLE_LSP_DOWNLOAD='true'
export OPENCODE_EXPERIMENTAL_LSP_TOOL='true'

acs() {
  export AWS_PROFILE=$(aws configure list-profiles | fzf)
  echo "Switched to AWS profile: $AWS_PROFILE"
}

# Secrets
[ -f $HOME/.secrets.zsh ] && source $HOME/.secrets.zsh

# alias
alias ls='lsd'
alias l='ls -l'
alias la='ls -a'
alias lla='ls -la'
alias lt='ls --tree'
alias cat='bat'
alias n='nvim'

alias cm='chezmoi'
alias cme='chezmoi edit --apply'

alias lg='lazygit'
alias hb='hibiscus'

alias co='codex'
alias cc='claude'
alias gc='gemini'
alias oc='opencode'
alias ccusage='bunx ccusage@latest'
alias cousage='bunx @ccusage/codex@latest'

alias k='kubectl'
alias i='istioctl'
alias kcs='kubectl config use-context $(kubectl config get-contexts -o name | fzf)'

alias tg='terragrunt'
alias tf='terraform'

alias an='ansible'
alias anp='ansible-playbook'
alias ang='ansible-galaxy'

# wezterm
alias we='wezterm'
[ -f $HOME/.wezterm.zsh ] && source $HOME/.wezterm.zsh

# tmux
alias t='tmux'
[ -f $HOME/.tmux.zsh ] && source $HOME/.tmux.zsh

# krew
export PATH="${KREW_ROOT:-$HOME/.krew}/bin:$PATH"

# mise
eval "$(mise activate zsh)"

# fnox
eval "$(fnox activate zsh)"

# docker buildkit enable
export DOCKER_BUILDKIT=1
export COMPOSE_DOCKER_CLI_BUILD=1

# bat
alias bat='bat --paging=never --style=plain'
alias -g -- --help='--help 2>&1 | bat --language=help --style=plain'

# zoxide
eval "$(zoxide init zsh --cmd j)"

# carapace
export CARAPACE_BRIDGES='zsh,fish,bash,inshellisense' # optional
zstyle ':completion:*' format $'\e[2;37mCompleting %d\e[m'
source <(carapace _carapace)

# direnv
eval "$(direnv hook zsh)"

# 1password-cli
# eval "$(op completion zsh)"; compdef _op op # completion

# starship
eval "$(starship init zsh)"

# fx
# source <(fx --comp zsh)

# fzf
source <(fzf --zsh)
alias f='cd $(fd --type directory --hidden --exclude .git | fzf)'

# television
# eval "$(tv init zsh)"

# codex
# eval "$(codex completion zsh)"
{{ end -}}

{{ if eq .osid "linux-arch" -}}
# Antidote
source '/usr/share/zsh-antidote/antidote.zsh'
antidote load

# ENV variables
export EDITOR='nvim'
export OPENCODE_DISABLE_LSP_DOWNLOAD='true'
export OPENCODE_EXPERIMENTAL_LSP_TOOL='true'

# Secrets
[ -f $HOME/.secrets.zsh ] && source $HOME/.secrets.zsh

# alias
alias ls='lsd'
alias l='ls -l'
alias la='ls -a'
alias lla='ls -la'
alias lt='ls --tree'
alias cat='bat'
alias n='nvim'

alias cm='chezmoi'
alias cme='chezmoi edit --apply'

alias lg='lazygit'
alias hb='hibiscus'

alias co='codex'
alias cc='claude'
alias gc='gemini'
alias oc='opencode'

alias k='kubectl'
alias i='istioctl'
alias kcs='kubectl config use-context $(kubectl config get-contexts -o name | fzf)'

alias tg='terragrunt'
alias tf='terraform'

alias an='ansible'
alias anp='ansible-playbook'
alias ang='ansible-galaxy'

# tmux
alias t='tmux'
[ -f $HOME/.tmux.zsh ] && source $HOME/.tmux.zsh

# mise
eval "$(mise activate zsh)"

# fnox
eval "$(fnox activate zsh)"

# bat
alias bat='bat --paging=never --style=plain'
alias -g -- --help='--help 2>&1 | bat --language=help --style=plain'

# zoxide
eval "$(zoxide init zsh --cmd j)"

# carapace
export CARAPACE_BRIDGES='zsh,fish,bash,inshellisense' # optional
zstyle ':completion:*' format $'\e[2;37mCompleting %d\e[m'
source <(carapace _carapace)

# direnv
eval "$(direnv hook zsh)"

# starship
eval "$(starship init zsh)"

# fzf
source <(fzf --zsh)
alias f='cd $(fd --type directory --hidden --exclude .git | fzf)'
{{ end -}}

# End timer and calculate duration
zsh_end_time=$EPOCHREALTIME
zsh_load_time=$(echo "$zsh_end_time - $zsh_start_time" | bc)
echo "Zsh startup time: ${zsh_load_time} seconds"
