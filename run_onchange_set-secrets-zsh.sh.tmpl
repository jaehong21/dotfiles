{{ if eq .chezmoi.os "darwin" -}}
#!/bin/bash

# Hash: {{ include ".chezmoidata/secrets.yaml" | sha256sum }}

# Create or truncate the secrets file
cat > "$HOME/.secrets.zsh" <<'EOF'
# Secrets managed by chezmoi
# Do not edit this file directly - edit .chezmoidata/secrets.yaml instead

{{ range $key, $value := .secrets -}}
export {{ $key }}='{{ onepasswordRead $value }}'
{{ end -}}
EOF

chmod 600 "$HOME/.secrets.zsh"
{{ end -}}
