{{ if eq .osid "darwin" -}}
#!/bin/bash

# Hash: {{ include "dot_config/fnox/config.toml" | sha256sum }}

# Create or truncate the secrets file
cat > "$HOME/.secrets.zsh" <<'EOF'
# Secrets managed by chezmoi
# Do not edit this file directly - edit fnox config.toml instead
EOF

# Get secret names from fnox config and export each
for secret in $(yq -oy '.secrets | keys | .[]' "$HOME/.config/fnox/config.toml"); do
  echo "export ${secret}='$(fnox get "$secret")'" >> "$HOME/.secrets.zsh"
done

chmod 600 "$HOME/.secrets.zsh"
{{ end -}}
